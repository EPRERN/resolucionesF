<app-nav></app-nav>
<br><br><br>
<div class="container">
  <h2>Agregar Nueva Resolución</h2>

  <form (ngSubmit)="agregarResolucion()">

    <!-- TEMA -->
    <div class="form-group">
      <label for="tema">Tema:</label>
      <select id="tema" [(ngModel)]="nuevaResolucion.tema.t_temasid" name="tema" required>
        <option *ngFor="let t of temas" [value]="t.t_temasid">
          {{ t.t_temasdescripcion }}
        </option>
      </select>
    </div>


     <!-- ARCHIVO LOTUS -->
    <div class="form-group">
      <label for="lotusFile">Archivo Lotus (solo para parsear datos):</label>
      <input id="lotusFile" type="file" (change)="onLotusFileSelected($event)">
    </div>

    <!-- ARCHIVO PDF -->
    <div class="form-group">
      <label for="pdfFile">Archivo PDF (se guarda en BDD):</label>
      <input id="pdfFile" type="file" accept="application/pdf" (change)="onPdfFileSelected($event)">
    </div>

<br><span style="margin-left: 200px; color: #25547a; font-size: x-large;">Estos campos de abajo no se completan</span><hr>
    <!-- NRO RESOLUCIÓN -->
    <div class="form-group">
      <label for="nro">Nro Resolución:</label>
      <input id="nro" type="text" [(ngModel)]="nuevaResolucion.t_resolucionesnro" name="nro" required placeholder="Ej: 123/2025">
    </div>

    <!-- EXPEDIENTE -->
    <div class="form-group">
      <label for="expte">Expediente:</label>
      <input id="expte" type="text" [(ngModel)]="nuevaResolucion.t_resolucionesexpte" name="expte" placeholder="Ej: EXP-456">
    </div>

    <!-- CARÁTULA -->
    <div class="form-group">
      <label for="caratula">Carátula:</label>
      <input id="caratula" type="text" [(ngModel)]="nuevaResolucion.t_resolucionesexptecaratula" name="caratula" placeholder="Carátula del expediente">
    </div>

    <!-- TÍTULO -->
    <div class="form-group">
      <label for="titulo">Título:</label>
      <input id="titulo" type="text" [(ngModel)]="nuevaResolucion.t_resolucionestitulo" name="titulo" placeholder="Título de la resolución">
    </div>

    <!-- FECHA -->
    <div class="form-group">
      <label for="fecha">Fecha:</label>
      <input id="fecha" type="text" [value]="formatDateToBackend(nuevaResolucion.t_resolucionesdate)" readonly>
    </div>

    <!-- DISTRIBUIDORA -->
    <div class="form-group">
      <label for="distribuidora">Distribuidora ID:</label>
      <input id="distribuidora" type="number" [(ngModel)]="nuevaResolucion.distribuidora.t_distribuidorasid" name="distribuidora" readonly>
    </div>

   

    <div class="button-container">
      <button type="submit">Guardar Resolución</button>
    </div>

  </form>
</div>

<table>
    <thead>
        <tr>
            <th>Nro Resolucion</th>
            <th>Título</th>
            <th>Expte</th>
            <th>Carátula</th>
            <th>Fecha</th>
            <th>Distribuidora</th>
            <th>Acciones</th>
            
        </tr>
    </thead>
    <tbody>
        <tr *ngFor="let r of resolucionesPaginadas">
            
            <td>{{ r.t_resolucionesnro }}</td>
            <td>{{ r.t_resolucionestitulo }}</td>
            <td>{{ r.t_resolucionesexpte }}</td>
            <td>{{ r.t_resolucionesexptecaratula }}</td>
            <td>{{ r.t_resolucionesdate | date }}</td>
            <td>{{ r.distribuidora.t_distribuidorasnombre }}</td>
            <td>
                <button (click)="eliminarResolucion(r.t_resolucionesid!)">Eliminar</button>
                <span *ngIf="!r.t_resolucionesblob">No hay archivo cargado</span>
                
                
                <button (click)="descargarPDF(r.t_resolucionesid!)">Descargar PDF</button>
                
                
                <button type="button" (click)="abrirPreview(r.t_resolucionesid!)"
                [disabled]="!r.t_resolucionesblob">Vista Previa</button>
            </td>
        </tr>
    </tbody>
    
    
    
    
</table>

<div class="paginador">
    <button (click)="page = page - 1" [disabled]="page === 1">Anterior</button>
    
    
    
    <button (click)="page = page + 1" [disabled]="page === totalPages">Siguiente</button>
    
    <span>Página</span>
    <input type="number" [(ngModel)]="page" name="pagina" [min]="1" [max]="totalPages" (change)="irAPagina()">
    <span>de&nbsp;{{ totalPages }}</span>
    
    <div class="filtros">
        <input type="text" placeholder="Filtrar por Nro Resolucion" [(ngModel)]="filtroNro" (input)="aplicarFiltro()">&nbsp;&nbsp;
        <input type="text" placeholder="Filtrar por Expte" [(ngModel)]="filtroExpte" (input)="aplicarFiltro()">
    </div>
</div>

<app-pdf-preview *ngIf="pdfPreviewUrl" [fileUrl]="pdfPreviewUrl" (close)="cerrarPreview()"></app-pdf-preview> 